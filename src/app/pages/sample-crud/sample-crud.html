<p-toast />
<p-confirmDialog />

<div class="page-header">
    <h2>Data Wajib Pajak</h2>
    <p>Kelola data wajib pajak daerah</p>
</div>

<p-toolbar styleClass="crud-toolbar">
    <ng-template #start>
        <p-button label="Tambah" icon="pi pi-plus" severity="primary" (click)="openNew()" />
        <p-button label="Hapus" icon="pi pi-trash" severity="danger" [outlined]="true" (click)="deleteSelected()"
            [disabled]="selectedItems().length === 0" />
    </ng-template>
    <ng-template #end>
        <p-button icon="pi pi-download" [outlined]="true" severity="secondary" aria-label="Export" />
    </ng-template>
</p-toolbar>

<p-table [value]="data()" [(selection)]="selectedItems" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 25]"
    [globalFilterFields]="['npwpd', 'nama', 'alamat', 'jenisPajak']" [tableStyle]="{ 'min-width': '60rem' }"
    [rowHover]="true" dataKey="id" styleClass="crud-table" responsiveLayout="scroll">
    <ng-template #header>
        <tr>
            <th style="width: 3rem">
                <p-tableHeaderCheckbox />
            </th>
            <th pSortableColumn="npwpd">NPWPD <p-sortIcon field="npwpd" /></th>
            <th pSortableColumn="nama">Nama <p-sortIcon field="nama" /></th>
            <th pSortableColumn="alamat">Alamat <p-sortIcon field="alamat" /></th>
            <th pSortableColumn="jenisPajak">Jenis Pajak <p-sortIcon field="jenisPajak" /></th>
            <th pSortableColumn="status">Status <p-sortIcon field="status" /></th>
            <th style="width: 8rem">Aksi</th>
        </tr>
    </ng-template>
    <ng-template #body let-item>
        <tr>
            <td>
                <p-tableCheckbox [value]="item" />
            </td>
            <td>{{ item.npwpd }}</td>
            <td>{{ item.nama }}</td>
            <td>{{ item.alamat }}</td>
            <td>{{ item.jenisPajak }}</td>
            <td>
                <p-tag [value]="item.status" [severity]="getStatusSeverity(item.status)" />
            </td>
            <td>
                <div class="action-buttons">
                    <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="info"
                        (click)="editItem(item)" aria-label="Edit" />
                    <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
                        (click)="deleteItem(item)" aria-label="Hapus" />
                </div>
            </td>
        </tr>
    </ng-template>
    <ng-template #emptymessage>
        <tr>
            <td colspan="7" class="empty-message">Tidak ada data ditemukan.</td>
        </tr>
    </ng-template>
</p-table>

<!-- Create/Edit Dialog -->
<p-dialog [(visible)]="dialogVisible" [header]="isEditMode() ? 'Edit Data' : 'Tambah Data'" [modal]="true"
    [style]="{ width: '450px' }" [draggable]="false" [resizable]="false" styleClass="crud-dialog">
    <div class="form-grid">
        <div class="form-field">
            <label for="npwpd">NPWPD</label>
            <input pInputText id="npwpd" [ngModel]="currentItem().npwpd"
                (ngModelChange)="updateCurrentItem('npwpd', $event)" required autofocus
                [class.ng-invalid]="submitted() && !currentItem().npwpd" />
            @if (submitted() && !currentItem().npwpd) {
            <small class="error-text">NPWPD wajib diisi.</small>
            }
        </div>

        <div class="form-field">
            <label for="nama">Nama</label>
            <input pInputText id="nama" [ngModel]="currentItem().nama"
                (ngModelChange)="updateCurrentItem('nama', $event)" required
                [class.ng-invalid]="submitted() && !currentItem().nama" />
            @if (submitted() && !currentItem().nama) {
            <small class="error-text">Nama wajib diisi.</small>
            }
        </div>

        <div class="form-field">
            <label for="alamat">Alamat</label>
            <input pInputText id="alamat" [ngModel]="currentItem().alamat"
                (ngModelChange)="updateCurrentItem('alamat', $event)" />
        </div>

        <div class="form-field">
            <label for="jenisPajak">Jenis Pajak</label>
            <p-select id="jenisPajak" [options]="jenisPajakOptions" [ngModel]="currentItem().jenisPajak"
                (ngModelChange)="updateCurrentItem('jenisPajak', $event)" placeholder="Pilih Jenis Pajak"
                [style]="{ width: '100%' }" />
        </div>

        <div class="form-field">
            <label for="status">Status</label>
            <p-select id="status" [options]="statusOptions" [ngModel]="currentItem().status"
                (ngModelChange)="updateCurrentItem('status', $event)" placeholder="Pilih Status"
                [style]="{ width: '100%' }" />
        </div>
    </div>

    <ng-template #footer>
        <p-button label="Batal" icon="pi pi-times" [text]="true" (click)="hideDialog()" />
        <p-button label="Simpan" icon="pi pi-check" (click)="saveItem()" />
    </ng-template>
</p-dialog>